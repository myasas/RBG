<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Friends Timezone Dashboard</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #fff;
    color: #222;
    margin: 0;
    padding: 1rem;
    text-align: center;
  }
  h2 { margin-top: 1rem; }
  .countries { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }
  .country {
    border: 1px solid #ccc;
    border-radius: 1rem;
    padding: 1rem;
    width: 220px;
    background: #fafafa;
    transition: background 0.3s, color 0.3s;
  }
  .country.sleeping {
    background: #444;
    color: #eee;
  }
  .flag { font-size: 1.5rem; font-weight: bold; }
  .time { font-size: 1.2rem; margin-top: 0.3rem; }
  .friend { font-size: 0.9rem; margin-top: 0.25rem; }
  #sliderContainer { margin: 2rem 0; }
  input[type="range"] { width: 90%; max-width: 500px; }
  .availability {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-around;
    gap: 1rem;
    margin-top: 2rem;
  }
  .box {
    flex: 1 1 300px;
    border: 1px solid #ccc;
    border-radius: 0.8rem;
    padding: 1rem;
    text-align: left;
  }
  button {
    margin-top: 1rem;
    padding: 0.6rem 1.2rem;
    border: none;
    border-radius: 0.5rem;
    background: #007aff;
    color: white;
    cursor: pointer;
  }
  button:hover { background: #005ec2; }
</style>
</head>
<body>
<h1>ğŸŒ Friends Timezone Dashboard</h1>
<p>Base time: ğŸ‡±ğŸ‡° Sri Lanka</p>
<div id="sliderContainer">
  <input type="range" id="timeSlider" min="0" max="1439" step="15" />
  <p id="sliderTime"></p>
</div>
<div id="countries" class="countries"></div>

<div class="availability">
  <div class="box">
    <h2>âœ… Available (<span id="countAvailable">0</span>)</h2>
    <div id="availableList"></div>
  </div>
  <div class="box">
    <h2>ğŸ˜´ Unavailable (<span id="countUnavailable">0</span>)</h2>
    <div id="unavailableList"></div>
  </div>
</div>

<button id="copyButton">ğŸ“‹ Copy Available Friends</button>

<script>
const friends = [
  { name: "Kalana", flag: "ğŸ‡±ğŸ‡°", tz: "Asia/Colombo" },
  { name: "Vinula", flag: "ğŸ‡±ğŸ‡°", tz: "Asia/Colombo" },
  { name: "Gamitha", flag: "ğŸ‡±ğŸ‡°", tz: "Asia/Colombo" },
  { name: "Sunanda", flag: "ğŸ‡¨ğŸ‡¦", tz: "America/Toronto" },
  { name: "Dhananjaya", flag: "ğŸ‡¨ğŸ‡¦", tz: "America/Toronto" },
  { name: "Ashraq", flag: "ğŸ‡´ğŸ‡²", tz: "Asia/Muscat" },
  { name: "Sahanaka", flag: "ğŸ‡¦ğŸ‡º", tz: "Australia/Melbourne" },
  { name: "Yasas", flag: "ğŸ‡¦ğŸ‡º", tz: "Australia/Melbourne" },
  { name: "Praneeth", flag: "ğŸ‡¦ğŸ‡º", tz: "Australia/Perth" },
  { name: "Dinuka", flag: "ğŸ‡ºğŸ‡¸", tz: "America/Chicago" }
];

const countryNames = {
  "Asia/Colombo": "ğŸ‡±ğŸ‡° Sri Lanka",
  "America/Toronto": "ğŸ‡¨ğŸ‡¦ Toronto",
  "Asia/Muscat": "ğŸ‡´ğŸ‡² Oman",
  "Australia/Melbourne": "ğŸ‡¦ğŸ‡º Melbourne",
  "Australia/Perth": "ğŸ‡¦ğŸ‡º Perth",
  "America/Chicago": "ğŸ‡ºğŸ‡¸ Houston"
};

function getEmoji(hour) {
  if (hour >= 5 && hour < 12) return "ğŸŒ…"; // Morning
  if (hour >= 12 && hour < 17) return "ğŸŒ"; // Day
  if (hour >= 17 && hour < 22) return "ğŸŒ‡"; // Evening
  return "ğŸŒ™"; // Night
}

function isSleeping(hour) {
  return hour >= 22 || hour < 6;
}

function render(timeOffsetMinutes = 0) {
  const base = new Date();
  const countriesDiv = document.getElementById("countries");
  countriesDiv.innerHTML = "";

  const available = [];
  const unavailable = [];

  const grouped = {};
  for (const f of friends) {
    if (!grouped[f.tz]) grouped[f.tz] = [];
    grouped[f.tz].push(f);
  }

  for (const [tz, group] of Object.entries(grouped)) {
    for (const g of group) {
      const now = new Date(base.getTime() + timeOffsetMinutes * 60000);
      const options = { timeZone: g.tz, hour: "2-digit", minute: "2-digit", hour12: false };
      const formatter = new Intl.DateTimeFormat("en-US", options);
      const formattedTime = formatter.format(now);

      const hour24 = parseInt(formattedTime.split(":")[0], 10);
      const minute = formattedTime.split(":")[1];
      const sleeping = isSleeping(hour24);
      const emoji = getEmoji(hour24);
      const displayTime = new Intl.DateTimeFormat("en-US", {
        timeZone: g.tz,
        hour: "2-digit",
        minute: "2-digit",
        hour12: true
      }).format(now);

      const countryDivId = tz.replace(/[^a-zA-Z]/g, "");
      let countryDiv = document.getElementById(countryDivId);
      if (!countryDiv) {
        countryDiv = document.createElement("div");
        countryDiv.id = countryDivId;
        countryDiv.className = "country";
        countriesDiv.appendChild(countryDiv);
      }
      countryDiv.className = "country" + (sleeping ? " sleeping" : "");
      countryDiv.innerHTML = `<div class="flag">${countryNames[tz]}</div>
                              <div class="time">${displayTime}</div>
                              <div class="friend">${group.map(f=>f.name).join("<br>")}</div>`;

      const entry = `${g.flag} ${g.name} â€” ${displayTime} ${emoji}`;
      if (sleeping) unavailable.push(entry);
      else available.push(entry);
    }
  }

  document.getElementById("availableList").innerHTML = available.join("<br>");
  document.getElementById("unavailableList").innerHTML = unavailable.join("<br>");
  document.getElementById("countAvailable").innerText = available.length;
  document.getElementById("countUnavailable").innerText = unavailable.length;

  const sliderLabel = document.getElementById("sliderTime");
  const ref = new Date(base.getTime() + timeOffsetMinutes * 60000);
  const slFormatter = new Intl.DateTimeFormat("en-US", {
    timeZone: "Asia/Colombo",
    hour: "2-digit",
    minute: "2-digit",
    hour12: true
  });
  sliderLabel.textContent = `ğŸ‡±ğŸ‡° Sri Lanka Time: ${slFormatter.format(ref)}`;

  window.currentData = { available, unavailable };
}

function setup() {
  const slider = document.getElementById("timeSlider");
  slider.addEventListener("input", () => render(parseInt(slider.value)));
  document.getElementById("copyButton").addEventListener("click", () => {
    const { available, unavailable } = window.currentData;
    const text = `${available.length} out of ${friends.length} friends are available.\n\nAvailable:\n${available.join("\n")}\n\nUnavailable:\n${unavailable.join("\n")}`;
    navigator.clipboard.writeText(text);
    alert("Copied!");
  });
  render();
  setInterval(() => render(parseInt(slider.value)), 300000); // refresh every 5 min
}

setup();
</script>
</body>
</html>
